# Fallout Wiki Crawler

–ü–æ–∏—Å–∫–æ–≤—ã–π —Ä–æ–±–æ—Ç –¥–ª—è –æ–±–∫–∞—á–∫–∏ Fallout Wiki —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ü–æ–ª–Ω–∞—è –æ–±–∫–∞—á–∫–∞ –≤–∏–∫–∏**: –û–±–∫–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å—Ç–∞—Ç—å–∏ –∏–∑ Fallout Wiki
- üîÑ **–í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º–æ—Å—Ç—å**: –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —Ç–æ–≥–æ –∂–µ –º–µ—Å—Ç–∞
- üîç **–î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç MD5-—Ö–µ—à –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚è∞ **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø–µ—Ä–µ–æ–±–∫–∞—á–∫–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–æ–±–∫–∞—á–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- üê≥ **Docker-ready**: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–∫–∞—á–µ–Ω–Ω—ã—Ö, –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- üõë **Graceful shutdown**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏ (Ctrl+C)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
mai-ir/
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ crawler.py           # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫—Ä–∞—É–ª–µ—Ä–∞
‚îú‚îÄ‚îÄ db_manager.py        # –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–∞–±–æ—Ç—ã —Å MongoDB
‚îú‚îÄ‚îÄ url_normalizer.py    # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è URL
‚îú‚îÄ‚îÄ config.yaml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt     # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile          # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml  # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ .dockerignore       # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Docker
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### 1. –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å MongoDB –∏ –∫—Ä–∞—É–ª–µ—Ä
docker-compose up -d

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f crawler
```

### 2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫—Ä–∞—É–ª–µ—Ä (MongoDB –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)
docker-compose stop crawler

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
docker-compose down -v
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# –ö—Ä–∞—É–ª–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
docker-compose restart crawler
```

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ó–∞–ø—É—Å–∫ MongoDB

```bash
# –ß–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
docker-compose up -d mongodb

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MongoDB –ª–æ–∫–∞–ª—å–Ω–æ
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.yaml`:
```yaml
db:
  host: "localhost"  # –ò–∑–º–µ–Ω–∏—Ç–µ —Å "mongodb" –Ω–∞ "localhost"
  port: 27017
  # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

### 4. –ó–∞–ø—É—Å–∫ –∫—Ä–∞—É–ª–µ—Ä–∞

```bash
python main.py config.yaml
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `config.yaml` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```yaml
db:
  host: "mongodb"              # –•–æ—Å—Ç MongoDB
  port: 27017                  # –ü–æ—Ä—Ç MongoDB
  database: "fallout_wiki"     # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

logic:
  delay_seconds: 1.0           # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)
  recrawl_age_days: 30         # –ü–µ—Ä–µ–æ–±–∫–∞—á–∏–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π
  user_agent: "FalloutWikiCrawler/1.0"
  max_retries: 3               # –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ
  timeout_seconds: 30          # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞

crawler:
  start_url: "https://fallout.fandom.com/wiki/Special:Categories"
  domain_whitelist:
    - "fallout.fandom.com"     # –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ MongoDB

### –ö–æ–ª–ª–µ–∫—Ü–∏—è `documents`

```javascript
{
  "_id": ObjectId,
  "url": "https://fallout.fandom.com/wiki/Article_Name",
  "html": "<html>...</html>",
  "source": "Fallout Wiki",
  "timestamp": 1734480000,
  "content_hash": "5d41402abc4b2a76b9719d911017c592"
}
```

### –ö–æ–ª–ª–µ–∫—Ü–∏—è `crawl_state`

```javascript
{
  "_id": "main_crawler",
  "current_category_index": 42,
  "current_category_url": "https://...",
  "current_article_index": 15,
  "total_categories": 100,
  "pages_crawled": 1500,
  "pages_updated": 200,
  "pages_skipped": 1300,
  "last_updated": 1734480000
}
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π**: –ö—Ä–∞—É–ª–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã Special:Categories –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —É—á–µ—Ç–æ–º –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
2. **–û–±—Ö–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**: –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –≤—Å–µ —Å—Ç–∞—Ç—å–∏ (—Ç–∞–∫–∂–µ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)
3. **–û–±–∫–∞—á–∫–∞ —Å—Ç–∞—Ç–µ–π**: –ö–∞–∂–¥–∞—è —Å—Ç–∞—Ç—å—è —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MongoDB
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π**: –ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è MD5-—Ö–µ—à –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º
5. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –ö–∞–∂–¥—ã–µ 10 —Å—Ç–∞—Ç–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
6. **–í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –∫—Ä–∞—É–ª–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–ö—Ä–∞—É–ª–µ—Ä –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç:

- **Ctrl+C**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É
- **docker-compose stop**: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –∫—Ä–∞—É–ª–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
docker-compose logs -f crawler
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB

```bash
# –ß–µ—Ä–µ–∑ Docker
docker exec -it fallout_wiki_mongodb mongosh fallout_wiki

# –õ–æ–∫–∞–ª—å–Ω–æ
mongosh mongodb://localhost:27017/fallout_wiki
```

### –ü–æ–ª–µ–∑–Ω—ã–µ MongoDB –∑–∞–ø—Ä–æ—Å—ã

```javascript
// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
db.documents.countDocuments()

// –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–∫–∞—á–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
db.documents.find().sort({timestamp: -1}).limit(10)

// –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫—Ä–∞—É–ª–µ—Ä–∞
db.crawl_state.findOne({_id: "main_crawler"})

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–∞—Ç–∞–º
db.documents.aggregate([
  {$group: {
    _id: {$dateToString: {format: "%Y-%m-%d", date: {$toDate: {$multiply: ["$timestamp", 1000]}}}},
    count: {$sum: 1}
  }},
  {$sort: {_id: -1}}
])
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ó–∞–¥–µ—Ä–∂–∫–∞**: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–ü–∞–º—è—Ç—å**: ~100-200 –ú–ë RAM –¥–ª—è –∫—Ä–∞—É–ª–µ—Ä–∞
- **–î–∏—Å–∫**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ HTML (–ø—Ä–∏–º–µ—Ä–Ω–æ 1-2 –ì–ë –¥–ª—è –≤—Å–µ–π –≤–∏–∫–∏)
- **–í—Ä–µ–º—è**: –ü–æ–ª–Ω–∞—è –æ–±–∫–∞—á–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### MongoDB –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ MongoDB
docker-compose logs mongodb

# –£–¥–∞–ª–∏—Ç—å volume –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose down -v
docker-compose up -d
```

### –ö—Ä–∞—É–ª–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MongoDB

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ MongoDB –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
docker-compose ps

# –ü–æ–¥–æ–∂–¥–∞—Ç—å, –ø–æ–∫–∞ MongoDB –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
docker-compose up -d mongodb
sleep 10
docker-compose up -d crawler
```

### –û—à–∏–±–∫–∏ Python

```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
docker-compose build --no-cache crawler
docker-compose up -d crawler
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π (–¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ –∫—É—Ä—Å—É "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫").

## –ê–≤—Ç–æ—Ä

–°–æ–∑–¥–∞–Ω–æ –¥–ª—è –∫—É—Ä—Å–∞ –ú–ê–ò "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫", –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ2.
